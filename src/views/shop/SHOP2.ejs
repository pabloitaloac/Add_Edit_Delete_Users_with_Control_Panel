<html lang="pt-br">
  <header>
    <%- include('../partials/head.ejs') %>
    <%- include('../partials/shop/navbarShop.ejs') %>
    <%- include('../partials/AddUser.ejs') %>
  </header>

  <body>
    <div>
      <h2>
      SHOP Em construção...
        <br>
      SHOP under construction...
      </h2>
    </div>


    <!-- <div>
      <form  method="post" id="formTestAjax" action="/shop/ajax">
        valor1:
        <input type="number" name="valor1" id="valor1">
        Valor2:
        <input type="number" name="valor2" id="valor2">
        <button type="button" onclick="tstAjax(valor1, valor2)" value="teste Ajax">teste Ajax</button>

        <br>

        <p id="changeByAjax" name="changeByAjax"></p>
      </form>
    </div> -->

    <br />
    
<!-- <div> -->
<a class="allContents" id="allContents">

<div class="showProducts" id="showProducts">
    

<%  if(allProducts.length > 0) { allProducts.forEach( product => {     %>

    <form id="singleProduct">
      <!-- <a href=""> -->
        <img
        id="image"
        class="imageProduct"
        src="<%=product.productImage%>"
        />
        
        
        <p class="name"  id="<%=product.productName%>-name"><%=product.productName%></p>
        
        
        <p class="situation">disponíveis: &nbsp</p>                
        <p class="situation" id="<%=product.productName%>-situation"><%=product.productQtd%></p>
    
                <br>
                
                <p class="preCost">Preço: &nbsp</p>
                <p class="rs">R$</p><p class="cost" id="<%=product.productName%>-cost"><%=product.productNormalPrice.toFixed(2)%></p>
                
                <br>
                
                <%  if(product.productSpecialPrice != null){ %>
                  <p class="prePromo">Clube Fidelidade: &nbsp</p>
                  <p class="rs">R$</p><p class="promo" id="<%=product.productName%>-promo"><%=product.productSpecialPrice.toFixed(2)%></p>
                  <br>
                  
                  <p id="promo"></p>

                  <% } else {%>
                    <p class="promo" id="<%=product.productName%>-promo"><%=null %></p>
                  <% } %>
          
                
                
                
                
                <br>
                
                
                <label class="txtQtdProduct" for="qtdProduct">Quantidade:</label>
                <input type="number" class="qtdProduct" name="qtdProduct" id="qtdProduct" value=1>
                
                <br><br>
                
                <button type="button" id="<%=product.productCode%>" 
                  onclick="addToCart(id, qtdProduct.value)">                  
                  Adicionar ao carrinho
                </button>
                <!-- </a> -->
              </form>
              <!-- </li> -->
              
              
              <%  })  } %>
              

            <p>
              <select name="pageSelector" id="pageSelector">
                <option value="1">1</option>
              </select>
            </p>


</div>
          
          
<!--           
          <b class="cartInPage" id="cartInPage">
            
            <h3 class="nameCart">Carrinho: <hr><br></h3>
            <p class="cartToChange" id="cartToChange">        
            </p>
            <br><hr>
            <p class="totalToChange" id="totalToChange">
              
              TOTAL: R$0.00
            </p>
            
          </b>          
           -->
</a>
        
</body>
      
      <footer><%- include('../partials/foot.ejs') %></footer>
      
  <style>

    .allContents{                
        
        text-align: center;
        
        padding: 10px;

    }
    

    .cartInPage{
      max-width: 350px;
      height: 50px;
      padding: 10px;

      
      border-radius: 5px;
      
      text-align: center;
      align-items: center;
      align-content: center;
      
      
      display: inline-table;

      background-color: rgb(255, 255, 255);

      margin-left: 50px;  
      margin-top: 0px;

      
      border-radius: 5px;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);

      margin-bottom: 0pt;
      padding-bottom: 0pt;
    }

.infoCartPromo{
  color: rgb(0, 214, 0);
}

.totalToChange{
      color: rgb(0, 0, 0);

      font-size: 14pt;
      font-weight: bold;

  }
    
    
    
    .showProducts {
      width: auto;    
      height: auto;    

      /* padding: 10px; */


      text-align: center;
      align-items: center;
      align-content: center;
      
      display: inline-table;

    }

    #singleProduct {
      /* width: 150px;
      height: 200px; */
      

      border: 1px;
      border-radius: 3%;
      border-style: solid;

      padding: 5px;
      display: inline-table;
      margin: 5px;

      text-align: center;
      align-items: center;
      align-content: center;
      


}
.qtdProduct{
  width: 30pt;
  text-align: center;
  
}
    .imageProduct {
      width: 100px;
      height: 100px;        
    }


    .preName, .name{
      color: rgb(0, 0, 0);
      font-size: 14pt;            
      font-weight: bold;
      text-transform: uppercase;
      line-height: 30pt;

    }

      .cost{
      color: rgb(255, 255, 255);
      background-color: rgb(116, 116, 255);

      font-size: 12pt;      
      font-weight: bold;

      max-height: 60px;
      width: fit-content;

      display: inline-table;

      border-radius: 10pt;
      padding: 5px;
      padding-top: 0px;
      padding-bottom: 0%;



    }

    .preCost,.prePromo,.rs{
      display: inline-table;
      font-size: 10pt;      
      font-weight: bold;

    }
    .promo{    
      color: rgb(255, 255, 255);
      background-color: rgb(0, 184, 0);
      font-size: 12pt;      
      font-weight: bold;

      max-height: 60px;
      width: fit-content;

      display: inline-table;

      border-radius: 10pt;
      padding: 5px;
      padding-top: 0px;
      padding-bottom: 0%;
  
    }

    .situation{
      font-size: 08pt;
      display: inline-table;

    }


  </style>


<script>

// function tstAjax(valor1, valor2){
  
//   event.preventDefault()  //avoid change page

//   var valor1 = Number(valor1.value)
//   var valor2 = Number(valor2.value)

//   var ajax = new XMLHttpRequest()

//       ajax.open('POST', '/shop/ajax')
//         var params = `valor1=${valor1}&&valor2=${valor2}`

//       ajax.setRequestHeader('content-type','application/x-www-form-urlencoded')

//       ajax.onreadystatechange = function(){
//         document.getElementById('changeByAjax').innerHTML = ajax.responseText
//       }
      
//       ajax.send(params)



// }


function addToCart(id, qtdProduct){

var itemCode = id
var itemQtd = qtdProduct





var cookies = document.cookie.split(';');//contains all the cookies
var cookieName = []; // to contain name of all the cookies

for(let i=0;i<cookies.length;i++) {
  cookieName[i] = cookies[i].split('=')[0].trim();
}


if(cookieName.includes('userID')) {
  alert("EXIST ID")

      // SENDIND WITH AJAX  ===============

      var ajax = new XMLHttpRequest()

      ajax.open('POST', '/shop/cart/addProduct')
        var params = `itemCode=${itemCode}&&itemQtd=${itemQtd}`

      ajax.setRequestHeader('content-type','application/x-www-form-urlencoded')

      ajax.onreadystatechange = function(){
        
          var cartResponse = ajax.responseText
          
          alert(`Produto adicionado ao carrinho!`)
        
      }


      ajax.send(params)
}
else {
  alert("DOESN'T EXIST ID")

  var cartNoId = []

  cartNoId.push([id,qtdProduct])

  alert(cartNoId)

  // ==============================================================
  alert('CONTINUAR DAQUI')
}




}

// function addToCart(id, qtdProduct){
//   var qtdProduct = Number(qtdProduct)

//   // Item awready exist in cart?
//   if(!window.localStorage.getItem(id)){    
//     // Add item to LocalStorage
//       window.localStorage.setItem(id,qtdProduct)
//   }
//   else{
//     // know the quantity of this existent item
//     var thisItemQtd = Number(window.localStorage.getItem(id))
//         thisItemQtd = thisItemQtd + qtdProduct
    
//     // update item to LocalStorage with currently quantity
//     window.localStorage.setItem(id,thisItemQtd)
//   }

//   // Show all products with json
//   var allLocal = JSON.stringify(window.localStorage)
//     allLocal = allLocal.replace('{', '').replace('}', '')
//     allLocal = allLocal.split(',')





    

//           // separe each item
//           allLocal.forEach(item => {
//               // separe/show each product with json
//               item  = item.replace('"', '').replace('":"',':').replace('"', '')
//               item = item.split(':')

//               itemCode =Number(item[0])
//               itemQtd = Number(item[1])

//             // alert(`itemCode: ${itemCode} | itemQtd: ${itemQtd}`)



//             // SENDIND WITH AJAX  ===============

//             var ajax = new XMLHttpRequest()

//             ajax.open('POST', '/shop/cart')
//               var params = `itemCode=${itemCode}&&itemQtd=${itemQtd}`

//             ajax.setRequestHeader('content-type','application/x-www-form-urlencoded')

//             ajax.onreadystatechange = function(){
//               var newItem = document.createElement('p')
//               var cartToChange =  document.getElementById('cartToChange')
//                   cartToChange.appendChild(newItem)

//               newItem.innerHTML = ajax.responseText
//             }


//             ajax.send(params)



// });





  


// }



























// var allProducts = [] 

//   var cookie = {};
  
//   document.cookie.split(';').forEach(function(el) {
//     var [k,v] = el.split('=');
//     cookie[k.trim()] = v;
//   })
  
  
//   var CART = cookie['CART'].replace('[[', '[').replace(']]', ']').replace('],[' , ',')

//   CART = CART.split(',')
  
//   CART.push('[1]')
//   CART.push('[2]')
//   CART.push('[3]')
//   CART.push('[4]')
//   CART.push('[5]')
  
// alert(CART)

// for(let i = 0 ; i < 10 ; i++){
//   alert(CART [i])

// }

//   alert(typeof CART)

  

      

//   // DO NOT TOUCH ON RETURNs!!!!!!!!!
// function addToCart(cookieCART, productCode, productQtd) {
//   // document.cookie = `CART=`

// // CREATE ARRAY WITH SINGLE PRODUCTS + QTD

//   // IF IS A NEW PAGE, FORCE THE FIRST PUSH
//   if(allProducts.length == 0){
//     allProducts.push([parseInt(productCode),parseInt(productQtd)])
//     alert(allProducts.length)
//     alert(JSON.stringify(allProducts))

//     document.cookie = `CART=${JSON.stringify(allProducts)}; expires=Mon, 01 Jan 2024 00:00:00 UTC`
//     // document.cookie = `CART=${JSON.parse(allProducts)}; expires=Mon, 01 Jan 2024 00:00:00 UTC`

//     return 

//   }
//   else{

//     // TO VERIFY IF EXISTS THE PRODUCT ON PAGE
//       for( var i = 0 ; i < allProducts.length; i++){
//         alert(`FOR [${i}] [0]`)

//         // PRODUCT IS AWREADY FINDED AT ARRAY
//         if(productCode == allProducts[i][0]){
//           allProducts[i][1] = parseInt(allProducts[i][1]) + parseInt(productQtd)
//           allProducts[i][0] = parseInt(allProducts[i][0])

//           alert(`A [${i}] [0]`)
          
//           alert(`MATCH - productCode: ${allProducts[i][0]}, productQtd: ${allProducts[i][1]}  `)
//           alert(allProducts.length)     
//           alert(JSON.stringify(allProducts))

//           document.cookie = `CART=${JSON.stringify(allProducts)}; expires=Mon, 01 Jan 2024 00:00:00 UTC`
//           // document.cookie = `CART=${JSON.parse(allProducts)}; expires=Mon, 01 Jan 2024 00:00:00 UTC`

//           return 

        
                  
//           }
//       }
//   }

//   // IF NOT EXIST, (!= OF THE LAST ONE) AND IS THE END OF THE LIST, CREATE NEW PRODUCT
//       if (productCode != allProducts[allProducts.length - 1][0]){
//                   alert(`B [${i}] [0]`)

//                   allProducts.push([parseInt(productCode),parseInt(productQtd)])
//                   alert(allProducts.length)
//                   alert(JSON.stringify(allProducts))

//                   document.cookie = `CART=${JSON.stringify(allProducts)}; expires=Mon, 01 Jan 2024 00:00:00 UTC`

//                   // document.cookie = `CART=${JSON.parse(allProducts)}; expires=Mon, 01 Jan 2024 00:00:00 UTC`

//                   return 
//       }




// // PASS THE CONDICTIONS TO COOKIE
// // document.cookie = `CART=${allProducts}`

// }











// function addToCart(cookieCART, productCode, productQtd) {

  
  
//   var cookie = {};
  
//   document.cookie.split(';').forEach(function(el) {
//     var [k,v] = el.split('=');
//     cookie[k.trim()] = v;
//   })
  
//   // return cookie['CART'];
  
//   var CART = cookie[cookieCART]
  
//   var a = productCode
//   var b = productQtd.value
//   // var date = new Date
  
//   document.cookie = `CART=${CART}+${a}/${b}`
//   // document.cookie = `CART=`

  
//   var anyCLICK = CART.split('+')
      
//       for(var i = 0; i < anyCLICK.length; i++){
        
//         var anyProduct = anyCLICK[i].split('/')
  

//         // allProducts.push(anyProduct[0])

//         //       for(var t = 0  ; t < allProducts.length ; t++){

//         //         if(anyProduct[0] == allProducts[t]){

//         //           alert(`OK - anyProduct[0]: ${anyProduct[0]} - allProducts[t]: ${allProducts[t]}   `)
//         //         }


//         //       }



//       }

//         // alert(allProducts)

//         // alert(`allProducts: ${allProducts} ; anyCLICK: ${anyCLICK}`)
//         alert(allProducts)


// }





// function addToCart(thisProduct, qtdProduct){

//     var q = qtdProduct.value

//       var n = thisProduct
//       var im = document.getElementById(thisProduct+'-image')
//       var s = document.getElementById(thisProduct+'-situation').textContent


//       var c = ((document.getElementById(thisProduct+'-cost').textContent)*q).toFixed(2)
//           var cToNumber = parseFloat(c)

//       var p = ((document.getElementById(thisProduct+'-promo').textContent)*q).toFixed(2)
//         if((document.getElementById(thisProduct+'-promo').textContent).length<=0){
//           var p = null
//         }
//         else{
//           var c = p
//           var isPromo = true

//           var cToNumber = parseFloat(c)
//         }

//         //calculing - var sum == total
//         totalCart.push(cToNumber)
        
//                 var sum = 0.00;

//                 for(var i =0;i<totalCart.length;i++){
//                   sum+=totalCart[i];
//                 }

//         qtdCart.push(parseFloat(q))

//                 var qtdSum = 0

//                 for(var i = 0 ; i<qtdCart.length ; i++){
//                   qtdSum+=qtdCart[i]
//                 }
                


//       //adding to cart

        
      
//         var createPImage = document.createElement("a")
//                   createPImage.className = 'infoCart'
//         var createPNome = document.createElement("a")
//                   createPNome.className = 'infoCart'

//         var createPCost = document.createElement("a")
//                   createPCost.className = 'infoCart'

//                 if(isPromo == true){
//                   var createInfoPromo = document.createElement("a")
//                             createInfoPromo.className = 'infoCartPromo'

//                   createInfoPromo.innerHTML = `CLUBE!   &nbsp&nbsp&nbsp`
//                 }
                


//         createPNome.innerHTML = `| ${q} X ${n} = `
//         createPCost.innerHTML = `R$${c}<br>`
//         document.getElementById('totalToChange').innerHTML = `Itens: ${qtdSum} | TOTAL: R$${sum.toFixed(2)}`
        
//         if(isPromo == true){
//           document.getElementById('cartToChange').append(createInfoPromo)  
//         }
        
//         document.getElementById('cartToChange').append(createPNome)        
//         document.getElementById('cartToChange').append(createPCost)
        

//         //att total (02 decimals)
      
// }


</script>



</html>
